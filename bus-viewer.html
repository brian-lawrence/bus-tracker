<!DOCTYPE html>
<html>
  <head>
    <title>Bus Tracker - Viewer Phone</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPdqHZh3kIgyQRL8JUov1y03Ld3-WVk18"></script>
    <style>
      #map { height: 80vh; width: 100%; }
      body { font-family: Arial, sans-serif; padding: 2em; }
    </style>
  </head>
  <body>
    <h2>View Bus Location</h2>
    <label>Bus name: <input id="busName" value="School Bus" /> <button onclick="startWatching()">Watch</button></label>
    <div id="map"></div>
    <p id="status"></p>

    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyB1UVF1dEjA5B4tE3vi_s21IL1u-uPc51k",
        authDomain: "bus-tracking-9a279.firebaseapp.com",
        projectId: "bus-tracking-9a279",
        storageBucket: "bus-tracking-9a279.firebasestorage.app",
        messagingSenderId: "633252168555",
        appId: "1:633252168555:web:c1d1338ac090ae0e60422e"
    };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      let map, marker;

      function initMap(center) {
        map = new google.maps.Map(document.getElementById('map'), {
          center: center,
          zoom: 16
        });
        marker = new google.maps.Marker({
          position: center,
          map: map,
          title: 'Bus Location'
        });
      }

      function startWatching() {
        const busName = document.getElementById('busName').value || "School Bus";
        db.ref('buses/' + busName).on('value', snapshot => {
          const data = snapshot.val();
          if (data && data.lat && data.lng) {
            const pos = { lat: data.lat, lng: data.lng };
            if (!map) {
              initMap(pos);
            }
            marker.setPosition(pos);
            map.setCenter(pos);
            marker.setTitle(data.name || "Bus");
            document.getElementById('status').innerText = `Bus "${data.name}" at (${pos.lat.toFixed(5)}, ${pos.lng.toFixed(5)})`;
          } else {
            document.getElementById('status').innerText = "Waiting for bus location...";
          }
        });
      }
    </script>
  </body>
</html>
